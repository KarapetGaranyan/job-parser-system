vacancies_html = '''{% extends "base.html" %}

{% block title %}–í—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏ - Job Parser{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>üìã –í—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏</h2>
    <div>
        <a href="/export/csv" class="btn btn-success">üì• –°–∫–∞—á–∞—Ç—å CSV</a>
        <a href="/vacancies/text" class="btn btn-info" target="_blank">üìÑ –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–∏–¥</a>
    </div>
</div>

<div class="row mb-3">
    <div class="col-md-6">
        <select id="sourceFilter" class="form-select">
            <option value="">–í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</option>
            <option value="hh">HH.ru</option>
            <option value="superjob">SuperJob</option>
        </select>
    </div>
    <div class="col-md-6">
        <input type="text" id="companyFilter" class="form-control" placeholder="–§–∏–ª—å—Ç—Ä –ø–æ –∫–æ–º–ø–∞–Ω–∏–∏">
    </div>
</div>

<div id="vacanciesList">
    <div class="text-center">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
    </div>
</div>

<nav id="pagination" class="mt-4" style="display: none;"></nav>

<script>
let currentPage = 1;
let currentFilters = { source: '', company: '' };

async function loadVacancies(page = 1) {
    try {
        const params = new URLSearchParams({
            page: page,
            per_page: 10,
            source: currentFilters.source,
            company: currentFilters.company
        });
        
        const response = await fetch(`/api/vacancies?${params}`);
        const data = await response.json();
        
        if (data.error) {
            throw new Error(data.error);
        }
        
        displayVacancies(data.vacancies);
        displayPagination(data.pagination);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        document.getElementById('vacanciesList').innerHTML = 
            `<div class="alert alert-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
    }
}

function displayVacancies(vacancies) {
    const container = document.getElementById('vacanciesList');
    
    if (vacancies.length === 0) {
        container.innerHTML = '<div class="alert alert-info">–í–∞–∫–∞–Ω—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
        return;
    }
    
    let html = '';
    vacancies.forEach(vacancy => {
        const sourceClass = vacancy.source === 'hh' ? 'success' : 'info';
        const date = new Date(vacancy.created_at).toLocaleDateString('ru-RU');
        
        html += `
            <div class="card mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <h5 class="card-title">${vacancy.title}</h5>
                            <p class="card-text">
                                <strong>–ö–æ–º–ø–∞–Ω–∏—è:</strong> ${vacancy.company}<br>
                                <strong>–ó–∞—Ä–ø–ª–∞—Ç–∞:</strong> ${vacancy.salary}<br>
                                <strong>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> ${vacancy.location}<br>
                                <small class="text-muted">–î–æ–±–∞–≤–ª–µ–Ω–æ: ${date}</small>
                            </p>
                        </div>
                        <div>
                            <span class="badge bg-${sourceClass}">${vacancy.source.toUpperCase()}</span>
                        </div>
                    </div>
                    <a href="${vacancy.link}" target="_blank" class="btn btn-outline-primary btn-sm">
                        –û—Ç–∫—Ä—ã—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é
                    </a>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function displayPagination(pagination) {
    const nav = document.getElementById('pagination');
    
    if (pagination.pages <= 1) {
        nav.style.display = 'none';
        return;
    }
    
    let html = '<ul class="pagination justify-content-center">';
    
    // –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    html += `<li class="page-item ${pagination.page <= 1 ? 'disabled' : ''}">
        <a class="page-link" href="#" onclick="changePage(${pagination.page - 1})">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
    </li>`;
    
    // –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
    for (let i = 1; i <= pagination.pages; i++) {
        if (i === pagination.page) {
            html += `<li class="page-item active"><span class="page-link">${i}</span></li>`;
        } else {
            html += `<li class="page-item"><a class="page-link" href="#" onclick="changePage(${i})">${i}</a></li>`;
        }
    }
    
    // –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    html += `<li class="page-item ${pagination.page >= pagination.pages ? 'disabled' : ''}">
        <a class="page-link" href="#" onclick="changePage(${pagination.page + 1})">–°–ª–µ–¥—É—é—â–∞—è</a>
    </li>`;
    
    html += '</ul>';
    nav.innerHTML = html;
    nav.style.display = 'block';
}

function changePage(page) {
    currentPage = page;
    loadVacancies(page);
}

// –§–∏–ª—å—Ç—Ä—ã
document.getElementById('sourceFilter').addEventListener('change', function(e) {
    currentFilters.source = e.target.value;
    currentPage = 1;
    loadVacancies(1);
});

document.getElementById('companyFilter').addEventListener('input', function(e) {
    currentFilters.company = e.target.value;
    currentPage = 1;
    setTimeout(() => loadVacancies(1), 500); // Debounce
});

// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
loadVacancies();
</script>
{% endblock %}'''