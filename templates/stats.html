stats_html = '''{% extends "base.html" %}

{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - Job Parser{% endblock %}

{% block content %}
<h2 class="mb-4">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π</h2>

<div id="statsContainer">
    <div class="text-center">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
    </div>
</div>

<script>
async function loadStats() {
    try {
        const response = await fetch('/api/stats');
        const data = await response.json();
        
        if (data.error) {
            throw new Error(data.error);
        }
        
        displayStats(data);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
        document.getElementById('statsContainer').innerHTML = 
            `<div class="alert alert-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
    }
}

function displayStats(stats) {
    const container = document.getElementById('statsContainer');
    
    let html = `
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card text-center">
                    <div class="card-body">
                        <h1 class="card-title text-primary">${stats.total_vacancies}</h1>
                        <p class="card-text">–í—Å–µ–≥–æ –≤–∞–∫–∞–Ω—Å–∏–π –≤ –±–∞–∑–µ</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>–ü–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º</h5>
                    </div>
                    <div class="card-body">
    `;
    
    for (const [source, count] of Object.entries(stats.by_source)) {
        const percentage = ((count / stats.total_vacancies) * 100).toFixed(1);
        html += `
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span>${source.toUpperCase()}</span>
                <span class="badge bg-primary">${count} (${percentage}%)</span>
            </div>
        `;
    }
    
    html += `
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>–¢–æ–ø –∫–æ–º–ø–∞–Ω–∏–π</h5>
                    </div>
                    <div class="card-body">
    `;
    
    stats.top_companies.forEach(company => {
        html += `
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span>${company.name}</span>
                <span class="badge bg-success">${company.count}</span>
            </div>
        `;
    });
    
    html += `
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>–¢–æ–ø –ª–æ–∫–∞—Ü–∏–∏</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
    `;
    
    stats.top_locations.forEach(location => {
        html += `
            <div class="col-md-6 mb-2">
                <div class="d-flex justify-content-between align-items-center">
                    <span>${location.name}</span>
                    <span class="badge bg-info">${location.count}</span>
                </div>
            </div>
        `;
    });
    
    html += `
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    container.innerHTML = html;
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
loadStats();
</script>
{% endblock %}'''